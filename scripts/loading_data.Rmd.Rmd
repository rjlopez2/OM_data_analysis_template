---
title: "Freiburg experiments"
author: "Ruben Lopez"
date: "12/2/2021"
output: html_document
---



```{r}
pacman::p_load(readxl, here, ggplot2, dplyr, forcats, readr, tidyr, purrr)
```

here i am loading the dataset...


### Enviroment management

```{r}
#renv::activate()
#renv::init() with init you start a new instance of renv inside the current folder, so only do it one time per project at the main working directory
renv::snapshot()
```


### Loading the raw data


```{r}
here("OM_data") %>% 
  # list.dirs()
  list.files()
```


```{r}
here()
dataframe <- read_excel(path = here("OM_data", 
                                    "OM data 1st week Ruben's version.xlsx"), 
                        # col_types = list(Date = col_character()
                          # Animal = col_factor(),
                          # Genotype = col_factor(),
                          # Sex = col_factor(),
                          # Frequency = col_factor(),
                          # Condition = col_factor(),
                          # MAP = col_factor()
                        # ),
                        sheet = 1)
dataframe %>% str()
  
```



```{r}

dataframe <- dataframe %>% 
  mutate(across(where(is.character), factor)) %>% 
  mutate(MAP = factor(MAP)) %>% 
  mutate(Frequency = factor(Frequency)) %>% 
  mutate(Sex = factor(Sex))

dataframe %>% 
  str



```

```{r}

dataframe %>% 
  ggplot(aes(x = Genotype,
             y = `APD 30`)) +
  geom_jitter(aes(color = Animal,
                  shape = MAP) ) + 
  facet_grid( Condition ~ Frequency)
  

```







```{r}
dataframe %>% 
  nest(data =c(MAP, `APD 30`, `APD 75`, `APD 90`)) %>% 
  mutate(data = map(data, ~ .x %>% 
                      group_by(MAP) %>% 
                      summarize(across(where(is.double), mean)))) %>% 
  unnest(cols = data) %>% 
  # mutate(id = factor(rep(1:718))) %>% 
  ggplot(aes(x = Condition,
             y = `APD 30`,
             shape = Animal,
             group = Animal,
             color  = Animal)) +
  geom_line() + 
  geom_point() +
  facet_grid( MAP ~ Frequency)

```

```{r}
dataframe %>% 
  nest(data =c(MAP, `APD 30`, `APD 75`, `APD 90`)) %>% 
  mutate(data = map(data, ~ .x %>% 
                      group_by(MAP) %>% 
                      summarize(across(where(is.double), mean)))) %>% 
  unnest(cols = data) %>% 
  filter(Animal == "#1") %>% 
  filter(Date == "13.10.2021") %>% 
  filter(Frequency == 2)
```




```{r}
dataframe %>% 
  nest(data =c(MAP, `APD 30`, `APD 75`, `APD 90`)) %>% 
  mutate(data = map(data, ~ .x %>% 
                      group_by(MAP) %>% 
                      summarize(across(where(is.double), mean)))) %>% 
  unnest(cols = data) %>% 
  filter(Animal == "#1") %>% 
  filter(MAP == "1") 
```

